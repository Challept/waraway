const militaryData = {
  "Afghanistan": {
    "military_strength": 150000,
    "available_for_war": 25000000,
    "warplanes": 120,
    "tanks": 600,
    "naval_strength": 0
  },
  "Albania": {
    "military_strength": 8300,
    "available_for_war": 800000,
    "warplanes": 12,
    "tanks": 30,
    "naval_strength": 4
  },
  "Algeria": {
    "military_strength": 130000,
    "available_for_war": 7000000,
    "warplanes": 550,
    "tanks": 2025,
    "naval_strength": 85
  },
  "Angola": {
    "military_strength": 107000,
    "available_for_war": 6000000,
    "warplanes": 270,
    "tanks": 110,
    "naval_strength": 56
  },
  "Argentina": {
    "military_strength": 75000,
    "available_for_war": 18000000,
    "warplanes": 190,
    "tanks": 400,
    "naval_strength": 42
  },
  "Armenia": {
    "military_strength": 49000,
    "available_for_war": 500000,
    "warplanes": 64,
    "tanks": 400,
    "naval_strength": 0
  },
  "Australia": {
    "military_strength": 59000,
    "available_for_war": 5000000,
    "warplanes": 450,
    "tanks": 59,
    "naval_strength": 48
  },
  "Austria": {
    "military_strength": 25000,
    "available_for_war": 1000000,
    "warplanes": 79,
    "tanks": 56,
    "naval_strength": 0
  },
  "Azerbaijan": {
    "military_strength": 126000,
    "available_for_war": 3000000,
    "warplanes": 137,
    "tanks": 570,
    "naval_strength": 31
  },
  "Bangladesh": {
    "military_strength": 240000,
    "available_for_war": 65000000,
    "warplanes": 170,
    "tanks": 330,
    "naval_strength": 89
  },
  "Belarus": {
    "military_strength": 45000,
    "available_for_war": 1000000,
    "warplanes": 265,
    "tanks": 620,
    "naval_strength": 0
  },
  "Belgium": {
    "military_strength": 29000,
    "available_for_war": 1500000,
    "warplanes": 115,
    "tanks": 0,
    "naval_strength": 20
  },
  "Bolivia": {
    "military_strength": 34000,
    "available_for_war": 4000000,
    "warplanes": 40,
    "tanks": 70,
    "naval_strength": 63
  },
  "Bosnia and Herzegovina": {
    "military_strength": 10000,
    "available_for_war": 300000,
    "warplanes": 13,
    "tanks": 65,
    "naval_strength": 0
  },
  "Botswana": {
    "military_strength": 9000,
    "available_for_war": 200000,
    "warplanes": 12,
    "tanks": 40,
    "naval_strength": 0
  },
  "Brazil": {
    "military_strength": 334000,
    "available_for_war": 100000000,
    "warplanes": 715,
    "tanks": 437,
    "naval_strength": 112
  },
  "Bulgaria": {
    "military_strength": 29000,
    "available_for_war": 2000000,
    "warplanes": 55,
    "tanks": 320,
    "naval_strength": 28
  },
  "Burkina Faso": {
    "military_strength": 11500,
    "available_for_war": 8000000,
    "warplanes": 12,
    "tanks": 0,
    "naval_strength": 0
  },
  "Burundi": {
    "military_strength": 20000,
    "available_for_war": 3500000,
    "warplanes": 8,
    "tanks": 10,
    "naval_strength": 0
  },
  "Cambodia": {
    "military_strength": 125000,
    "available_for_war": 5000000,
    "warplanes": 50,
    "tanks": 245,
    "naval_strength": 35
  },
  "Cameroon": {
    "military_strength": 36000,
    "available_for_war": 4000000,
    "warplanes": 18,
    "tanks": 50,
    "naval_strength": 35
  },
  "Canada": {
    "military_strength": 67000,
    "available_for_war": 9000000,
    "warplanes": 390,
    "tanks": 82,
    "naval_strength": 62
  },
  "Chad": {
    "military_strength": 33000,
    "available_for_war": 4000000,
    "warplanes": 12,
    "tanks": 30,
    "naval_strength": 0
  },
  "Chile": {
    "military_strength": 80000,
    "available_for_war": 9000000,
    "warplanes": 255,
    "tanks": 265,
    "naval_strength": 70
  },
  "China": {
    "military_strength": 2000000,
    "available_for_war": 750000000,
    "warplanes": 3210,
    "tanks": 5250,
    "naval_strength": 777
  },
  "Colombia": {
    "military_strength": 293000,
    "available_for_war": 30000000,
    "warplanes": 290,
    "tanks": 0,
    "naval_strength": 234
  },
  "Congo (Democratic Republic)": {
    "military_strength": 134000,
    "available_for_war": 20000000,
    "warplanes": 20,
    "tanks": 200,
    "naval_strength": 23
  },
  "Croatia": {
    "military_strength": 15000,
    "available_for_war": 700000,
    "warplanes": 12,
    "tanks": 72,
    "naval_strength": 28
  },
  "Cuba": {
    "military_strength": 50000,
    "available_for_war": 1500000,
    "warplanes": 60,
    "tanks": 1200,
    "naval_strength": 18
  },
  "Cyprus": {
    "military_strength": 12000,
    "available_for_war": 100000,
    "warplanes": 10,
    "tanks": 82,
    "naval_strength": 9
  },
  "Czech Republic": {
    "military_strength": 25000,
    "available_for_war": 2000000,
    "warplanes": 50,
    "tanks": 123,
    "naval_strength": 0
  },
  "Denmark": {
    "military_strength": 15000,
    "available_for_war": 600000,
    "warplanes": 118,
    "tanks": 44,
    "naval_strength": 68
  },
  "Egypt": {
    "military_strength": 438500,
    "available_for_war": 42000000,
    "warplanes": 1053,
    "tanks": 4100,
    "naval_strength": 245
  },
  "Ethiopia": {
    "military_strength": 162000,
    "available_for_war": 40000000,
    "warplanes": 90,
    "tanks": 400,
    "naval_strength": 0
  },
  "Finland": {
    "military_strength": 23000,
    "available_for_war": 1000000,
    "warplanes": 55,
    "tanks": 200,
    "naval_strength": 19
  },
  "France": {
    "military_strength": 203000,
    "available_for_war": 31000000,
    "warplanes": 1055,
    "tanks": 406,
    "naval_strength": 180
  },
  "Germany": {
    "military_strength": 184000,
    "available_for_war": 3000000,
    "warplanes": 613,
    "tanks": 245,
    "naval_strength": 81
  },
  "Greece": {
    "military_strength": 134000,
    "available_for_war": 4000000,
    "warplanes": 566,
    "tanks": 1320,
    "naval_strength": 120
  },
  "India": {
    "military_strength": 1450000,
    "available_for_war": 622000000,
    "warplanes": 2100,
    "tanks": 4500,
    "naval_strength": 295
  },
  "Indonesia": {
    "military_strength": 400000,
    "available_for_war": 100000000,
    "warplanes": 463,
    "tanks": 315,
    "naval_strength": 281
  },
  "Iran": {
    "military_strength": 523000,
    "available_for_war": 47000000,
    "warplanes": 516,
    "tanks": 1775,
    "naval_strength": 398
  },
  "Iraq": {
    "military_strength": 350000,
    "available_for_war": 20000000,
    "warplanes": 179,
    "tanks": 350,
    "naval_strength": 16
  },
  "Israel": {
    "military_strength": 169500,
    "available_for_war": 9500000,
    "warplanes": 586,
    "tanks": 1650,
    "naval_strength": 67
  },
  "Italy": {
    "military_strength": 165500,
    "available_for_war": 25000000,
    "warplanes": 862,
    "tanks": 200,
    "naval_strength": 249
  },
  "Japan": {
    "military_strength": 247000,
    "available_for_war": 43000000,
    "warplanes": 1450,
    "tanks": 1004,
    "naval_strength": 155
  },
  "Mexico": {
    "military_strength": 215000,
    "available_for_war": 65000000,
    "warplanes": 464,
    "tanks": 0,
    "naval_strength": 145
  },
  "North Korea": {
    "military_strength": 1280000,
    "available_for_war": 6000000,
    "warplanes": 946,
    "tanks": 6000,
    "naval_strength": 967
  },
  "Norway": {
    "military_strength": 23000,
    "available_for_war": 600000,
    "warplanes": 132,
    "tanks": 36,
    "naval_strength": 53
  },
  "Pakistan": {
    "military_strength": 654000,
    "available_for_war": 96000000,
    "warplanes": 1364,
    "tanks": 2200,
    "naval_strength": 100
  },
  "Philippines": {
    "military_strength": 142000,
    "available_for_war": 40000000,
    "warplanes": 149,
    "tanks": 45,
    "naval_strength": 129
  },
  "Poland": {
    "military_strength": 114000,
    "available_for_war": 20000000,
    "warplanes": 469,
    "tanks": 700,
    "naval_strength": 83
  },
  "Russia": {
    "military_strength": 1000000,
    "available_for_war": 20000000,
    "warplanes": 4163,
    "tanks": 12500,
    "naval_strength": 603
  },
  "Saudi Arabia": {
    "military_strength": 227000,
    "available_for_war": 15000000,
    "warplanes": 848,
    "tanks": 1062,
    "naval_strength": 55
  },
  "South Africa": {
    "military_strength": 66000,
    "available_for_war": 6000000,
    "warplanes": 226,
    "tanks": 195,
    "naval_strength": 47
  },
  "South Korea": {
    "military_strength": 600000,
    "available_for_war": 25000000,
    "warplanes": 1640,
    "tanks": 2400,
    "naval_strength": 234
  },
  "Spain": {
    "military_strength": 125000,
    "available_for_war": 20000000,
    "warplanes": 503,
    "tanks": 327,
    "naval_strength": 133
  },
  "Sweden": {
    "military_strength": 22000,
    "available_for_war": 350000,
    "warplanes": 200,
    "tanks": 120,
    "naval_strength": 63
  },
  "Switzerland": {
    "military_strength": 21000,
    "available_for_war": 1500000,
    "warplanes": 95,
    "tanks": 134,
    "naval_strength": 0
  },
  "Turkey": {
    "military_strength": 355200,
    "available_for_war": 35000000,
    "warplanes": 1056,
    "tanks": 3045,
    "naval_strength": 194
  },
  "Ukraine": {
    "military_strength": 250000,
    "available_for_war": 22000000,
    "warplanes": 318,
    "tanks": 2600,
    "naval_strength": 38
  },
  "United Kingdom": {
    "military_strength": 195000,
    "available_for_war": 30000000,
    "warplanes": 733,
    "tanks": 227,
    "naval_strength": 75
  },
  "United States": {
    "military_strength": 1400000,
    "available_for_war": 11800000,
    "warplanes": 13247,
    "tanks": 6209,
    "naval_strength": 490
  },
  "Vietnam": {
    "military_strength": 482000,
    "available_for_war": 49000000,
    "warplanes": 291,
    "tanks": 2800,
    "naval_strength": 65
  }
  // You can continue to expand this list for additional countries...
};

// Translations from Swedish to English
const countryTranslations = {
  "sverige": "Sweden",
  "tyskland": "Germany",
  "ryssland": "Russia",
  "usa": "USA",
  "fÃ¶renade staterna": "USA",
  "deutschland": "Germany",
  "finland": "Finland",
  // Add more translations as needed
};

function levenshteinDistance(s1, s2) {
  const len1 = s1.length;
  const len2 = s2.length;
  const dp = Array(len2 + 1).fill(null).map(() => Array(len1 + 1).fill(null));

  for (let i = 0; i <= len1; i++) {
    dp[0][i] = i;
  }
  for (let j = 0; j <= len2; j++) {
    dp[j][0] = j;
  }

  for (let j = 1; j <= len2; j++) {
    for (let i = 1; i <= len1; i++) {
      const indicator = s1[i - 1] === s2[j - 1] ? 0 : 1;
      dp[j][i] = Math.min(
        dp[j][i - 1] + 1, // deletion
        dp[j - 1][i] + 1, // insertion
        dp[j - 1][i - 1] + indicator // substitution
      );
    }
  }
  return dp[len2][len1];
}

function findClosestCountry(input, countryList) {
  let closestCountry = countryList[0];
  let minDistance = levenshteinDistance(input.toLowerCase(), countryList[0].toLowerCase());

  for (let i = 1; i < countryList.length; i++) {
    const distance = levenshteinDistance(input.toLowerCase(), countryList[i].toLowerCase());
    if (distance < minDistance) {
      closestCountry = countryList[i];
      minDistance = distance;
    }
  }

  return closestCountry;
}

function translateCountry(input) {
  const lowerCaseInput = input.toLowerCase();
  // If the exact translation exists, return the English version for internal comparison
  if (countryTranslations[lowerCaseInput]) {
    return countryTranslations[lowerCaseInput];
  }

  // Otherwise, find the closest matching country in militaryData or translations
  const allCountries = Object.keys(militaryData).concat(Object.values(countryTranslations));
  return findClosestCountry(input, allCountries);
}

function compareCountries() {
  let country1Input = document.getElementById('country1').value;
  let country2Input = document.getElementById('country2').value;

  // Translate internally to English for comparison, but preserve the user's input for display
  let country1Internal = translateCountry(country1Input);
  let country2Internal = translateCountry(country2Input);

  fetch('https://restcountries.com/v3.1/all?fields=name,population')
    .then(response => response.json())
    .then(data => {
      // Find country data using the internal (English) name
      const c1 = data.find(country => country.name.common.toLowerCase() === country1Internal.toLowerCase());
      const c2 = data.find(country => country.name.common.toLowerCase() === country2Internal.toLowerCase());

      // Handle error if one of the countries is not found
      if (!c1 || !c2) {
        document.getElementById('result').innerHTML = `Country not found. Did you mean: ${!c1 ? country1Input : country2Input}?`;
        return;
      }

      // Display the results using the user's original input (country1Input and country2Input)
      let resultText = `
        <h3>${country1Input} vs. ${country2Input}</h3>
        <p><strong>Population:</strong> ${c1.population} vs. ${c2.population}</p>
      `;

      const c1Military = militaryData[c1.name.common];
      const c2Military = militaryData[c2.name.common];

      const militaryPromises = [];

      if (c1Military) {
        resultText += `
          <p><strong>${country1Input} Military Strength:</strong> ${c1Military.military_strength}</p>
          <p><strong>Available for War:</strong> ${c1Military.available_for_war}</p>
          <p><strong>Warplanes:</strong> ${c1Military.warplanes}</p>
          <p><strong>Tanks:</strong> ${c1Military.tanks}</p>
          <p><strong>Naval Strength:</strong> ${c1Military.naval_strength}</p>
        `;
      } else {
        militaryPromises.push(fetchMilitaryDataFromWikipedia(c1.name.common).then(militaryExtract => {
          resultText += `<p><strong>${country1Input} Military Data:</strong> ${militaryExtract}</p>`;
        }));
      }

      if (c2Military) {
        resultText += `
          <p><strong>${country2Input} Military Strength:</strong> ${c2Military.military_strength}</p>
          <p><strong>Available for War:</strong> ${c2Military.available_for_war}</p>
          <p><strong>Warplanes:</strong> ${c2Military.warplanes}</p>
          <p><strong>Tanks:</strong> ${c2Military.tanks}</p>
          <p><strong>Naval Strength:</strong> ${c2Military.naval_strength}</p>
        `;
      } else {
        militaryPromises.push(fetchMilitaryDataFromWikipedia(c2.name.common).then(militaryExtract => {
          resultText += `<p><strong>${country2Input} Military Data:</strong> ${militaryExtract}</p>`;
        }));
      }

      Promise.all(militaryPromises).then(() => {
        // Calculate scores to determine the winner
        let c1Score = (c1Military?.military_strength || 0) + c1.population;
        let c2Score = (c2Military?.military_strength || 0) + c2.population;

        if (c1Score > c2Score) {
          resultText += `<p><strong>Winner:</strong> ${country1Input} (Based on military strength, vehicles, and population)</p>`;
        } else if (c2Score > c1Score) {
          resultText += `<p><strong>Winner:</strong> ${country2Input} (Based on military strength, vehicles, and population)</p>`;
        } else {
          resultText += `<p><strong>Result:</strong> It's a tie!</p>`;
        }

        document.getElementById('result').innerHTML = resultText;
        showElementWithAnimation('result');
        showElementWithAnimation('about');
      });
    })
    .catch(error => console.log('Error fetching population data:', error));
}

// Add the "Enter" key functionality for inputs and button click event
document.getElementById('compareButton').addEventListener('click', compareCountries);
document.getElementById('country1').addEventListener('keydown', function(event) {
  if (event.key === 'Enter') {
    event.preventDefault();
    compareCountries();
  }
});
document.getElementById('country2').addEventListener('keydown', function(event) {
  if (event.key === 'Enter') {
    event.preventDefault();
    compareCountries();
  }
});

// Function to trigger animations
function showElementWithAnimation(id) {
  document.getElementById(id).classList.add('show');
}